<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
"http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="Userinfo">
	<!-- Alias Map Defined -->
	<typeAlias alias="UserinfoQuery" type="com.kifanle.test.query.UserinfoQuery" />
	<typeAlias alias="Userinfo" type="com.kifanle.test.pojo.UserinfoDO" />
	<resultMap id="userinfo" class="Userinfo">
		<result property="userid" column="userid" />
		<result property="loginname" column="loginname" />
		<result property="email" column="email" />
		<result property="mobile" column="mobile" />
		<result property="password" column="password" />
		<result property="nickname" column="nickname" />
		<result property="gender" column="gender" />
		<result property="mood" column="mood" />
		<result property="career" column="career" />
		<result property="interest" column="interest" />
		<result property="avatarUrl" column="avatar_url" />
		<result property="latlng" column="latlng" />
		<result property="createTime" column="create_time" />
		<result property="modifiedTime" column="modified_time" />
	</resultMap>
		
	<!-- Select SQL -->
	<sql id="userinfoDO.selector">
		SELECT userid,loginname,email,mobile,password,nickname,gender,mood,career,interest,avatar_url,latlng,create_time,modified_time		FROM userinfo
	</sql>
	<sql id="userinfoDOList.where">
		<dynamic>
			<isNotNull property="userid" prepend=" AND ">
				userid=#userid#
		  	</isNotNull>
			<isNotNull property="loginname" prepend=" AND ">
				loginname=#loginname#
		  	</isNotNull>
			<isNotNull property="email" prepend=" AND ">
				email=#email#
		  	</isNotNull>
			<isNotNull property="mobile" prepend=" AND ">
				mobile=#mobile#
		  	</isNotNull>
			<isNotNull property="password" prepend=" AND ">
				password=#password#
		  	</isNotNull>
			<isNotNull property="nickname" prepend=" AND ">
				nickname=#nickname#
		  	</isNotNull>
			<isNotNull property="mood" prepend=" AND ">
				mood=#mood#
		  	</isNotNull>
			<isNotNull property="career" prepend=" AND ">
				career=#career#
		  	</isNotNull>
			<isNotNull property="interest" prepend=" AND ">
				interest=#interest#
		  	</isNotNull>
			<isNotNull property="avatarUrl" prepend=" AND ">
				avatar_url=#avatarUrl#
		  	</isNotNull>
			<isNotNull property="latlng" prepend=" AND ">
				latlng=#latlng#
		  	</isNotNull>
		</dynamic>
	</sql>
	
		<sql id="userinfoDOList.order">
		<dynamic prepend=" ORDER BY "> 
			<isNotEmpty property="orderFields">
				<iterate property="orderFields" conjunction="," open="" close="">
					#orderFields[].fieldName# #orderFields[].order#
		        </iterate>
			</isNotEmpty>
		</dynamic>
	</sql>
	
		<select id="Userinfo.getUserinfoDO" resultMap="userinfo">
		<include refid="userinfoDO.selector" />
		WHERE userid=#userid#
	</select>
		
		<select id="Userinfo.getUserinfoDOsByKeys" resultMap="userinfo">
		<include refid="userinfoDO.selector" />
		WHERE userid in
		<iterate conjunction="," open="(" close=")" property="keys">
			#keys[]#
		</iterate>
	</select>	
		
		<delete id="Userinfo.deleteByKey">
		DELETE FROM userinfo
		WHERE userid = #key#
  	</delete>
		
		<delete id="Userinfo.deleteByKeys">
		DELETE FROM userinfo
		WHERE userid in
		<iterate conjunction="," open="(" close=")" property="keys">
			#keys[]#
		</iterate>
  	</delete>
		
		<select id="Userinfo.getUserInfoByEmail" resultMap="userinfo">
		<include refid="userinfoDO.selector" /> where 1=1	
							                 and mobile = #mobile#
											                 and gender = #gender#
								</select>		
					
		
			<update id="Userinfo.updateUserinfoDOsByKeys" parameterClass="Userinfo">
		UPDATE userinfo SET modified_time=now()
		<isNotNull prepend="," property="loginname">
			loginname = #loginname#
      	</isNotNull>
		<isNotNull prepend="," property="email">
			email = #email#
      	</isNotNull>
		<isNotNull prepend="," property="mobile">
			mobile = #mobile#
      	</isNotNull>
		<isNotNull prepend="," property="password">
			password = #password#
      	</isNotNull>
		<isNotNull prepend="," property="nickname">
			nickname = #nickname#
      	</isNotNull>
		<isNotNull prepend="," property="gender">
			gender = #gender#
      	</isNotNull>
		<isNotNull prepend="," property="mood">
			mood = #mood#
      	</isNotNull>
		<isNotNull prepend="," property="career">
			career = #career#
      	</isNotNull>
		<isNotNull prepend="," property="interest">
			interest = #interest#
      	</isNotNull>
		<isNotNull prepend="," property="avatarUrl">
			avatar_url = #avatarUrl#
      	</isNotNull>
		<isNotNull prepend="," property="latlng">
			latlng = #latlng#
      	</isNotNull>
		WHERE userid in
		<iterate conjunction="," open="(" close=")" property="keys">
			#keys[]#
		</iterate>
	</update>
	
	<update id="Userinfo.updateUserinfoDO" parameterClass="Userinfo">
		UPDATE userinfo SET modified_time=now()
		<isNotNull prepend="," property="loginname">
			loginname = #loginname#
      	</isNotNull>
		<isNotNull prepend="," property="email">
			email = #email#
      	</isNotNull>
		<isNotNull prepend="," property="mobile">
			mobile = #mobile#
      	</isNotNull>
		<isNotNull prepend="," property="password">
			password = #password#
      	</isNotNull>
		<isNotNull prepend="," property="nickname">
			nickname = #nickname#
      	</isNotNull>
		<isNotNull prepend="," property="gender">
			gender = #gender#
      	</isNotNull>
		<isNotNull prepend="," property="mood">
			mood = #mood#
      	</isNotNull>
		<isNotNull prepend="," property="career">
			career = #career#
      	</isNotNull>
		<isNotNull prepend="," property="interest">
			interest = #interest#
      	</isNotNull>
		<isNotNull prepend="," property="avatarUrl">
			avatar_url = #avatarUrl#
      	</isNotNull>
		<isNotNull prepend="," property="latlng">
			latlng = #latlng#
      	</isNotNull>
		WHERE userid = #userid#
	</update>
	
		
		<select id="Userinfo.getUserinfoListWithPage" parameterClass="UserinfoQuery" resultMap="userinfo">
		<include refid="userinfoDO.selector" />
		WHERE 1=1
		<include refid="userinfoDOList.where" />
		<include refid="userinfoDOList.order" />
	  	LIMIT #startRow#,#pageSize#
	</select>

	<select id="Userinfo.getUserinfoListCount" parameterClass="UserinfoQuery" resultClass="int">
		SELECT count(*) FROM userinfo
		WHERE 1=1
		<include refid="userinfoDOList.where" />
	</select>	
	
		<insert id="Userinfo.insertUserinfoDO" parameterClass="Userinfo">
		INSERT INTO userinfo(loginname,email,mobile,password,nickname,gender,mood,career,interest,avatar_url,latlng,			    create_time,modified_time)
		VALUES(#loginname#,#email#,#mobile#,#password#,#nickname#,#gender#,#mood#,#career#,#interest#,#avatarUrl#,#latlng#,				now(),now())
		<selectKey resultClass="long" type="post" keyProperty="userid">
           SELECT last_insert_id() AS userid
		</selectKey>
	</insert>

</sqlMap>